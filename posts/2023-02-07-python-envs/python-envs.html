<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Filip Wästberg">
<meta name="dcterms.date" content="2023-02-07">

<title>filipwastberg - A note on Python environments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">filipwastberg</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/filipwastberg"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/filipwastberrrg"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A note on Python environments</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Filip Wästberg </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 7, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>At least once a year I get a chance to dable with Python. This time I’m involved in a project where we develop outlier detection algorithms for district heating networks.</p>
<p>The code base relies on some old versions of packages and a stable version of Python itself.</p>
<section id="why-do-this" class="level2">
<h2 class="anchored" data-anchor-id="why-do-this">Why do this</h2>
<p>I’m a Data Scientist, I get paid to analyze data to solve problems. Most of the time I use R to do this.</p>
<p>As R users we are very spoiled by the package management system that is built into R. I install a package via <code>install.packages("dplyr")</code> and it <em>just works</em>. This is very nice feature since most of my work is not done with the intention of writing software. I mainly use it to investigate something: manipulate, visualize and model data. This means that the less time I need to spend on setup, the more productive I can be.</p>
</section>
<section id="virtual-environments-are-not-new-to-me" class="level2">
<h2 class="anchored" data-anchor-id="virtual-environments-are-not-new-to-me">Virtual environments are not new to me</h2>
<p>Of course, if I want my code to be used for production, for example scheduling a script, I want to make sure that the script doesn’t fail if I change my setup, like updating a package. So I know the concept of virtual environments. I have used R packages for this, like <code>renv</code> and <code>packrat</code>, and also Docker. But I use these when I need them.</p>
</section>
<section id="python-feels-like-a-lottery" class="level2">
<h2 class="anchored" data-anchor-id="python-feels-like-a-lottery">Python feels like a lottery</h2>
<p>My experience with Python has not been as frictionless (to be fair I have had my experience of setup trouble in R as well, yes I’m looking at you RJava). Using Python is like a lottery to me. Most of the times it works, but as soon as I have to do something out of the ordinary I run into to trouble. And my feeling is that in most cases this is because of virtual environments. Again, these troubles probably arise because I’m not a software developer, I’m a data analyst. So I’m not <em>really</em> interested in these things, I just want it to work.</p>
<p>So every time I have run into trouble when using Python I have usually spent a day googling and following different tutorials, then, for some reason, it works.</p>
<p>Now it has happened again. But I thought I’d write everything down this time.</p>
</section>
<section id="the-concept-of-virtual-environments" class="level2">
<h2 class="anchored" data-anchor-id="the-concept-of-virtual-environments">The concept of virtual environments</h2>
<p>In order to use Python productivly most developers will encourage you to use Virtual Environments.</p>
<p>I think of virtual environments as folders where you save all the packages that you use in Python. Ideally, you should be able to have different environments that can use different packages and different versions of Python. However, virtual environments mainly focus on the package side.</p>
<section id="what-version" class="level3">
<h3 class="anchored" data-anchor-id="what-version">What version?</h3>
<p>When you open the terminal and type <code>python --version</code> you can get different answers. I found <a href="https://towardsdatascience.com/python-the-system-path-and-how-conda-and-pyenv-manipulate-it-234f8e8bbc3e">this article</a> really helpful in understanding why this happens.</p>
</section>
</section>
<section id="venv" class="level2">
<h2 class="anchored" data-anchor-id="venv">venv</h2>
<p>As far as I’ve understood the built-in environment system for Python is <code>venv</code>.</p>
<p>To use it we can simply type in the terminal:</p>
<p><code>{bash eval=FALSE} python3 -m venv path-to-mynewenv</code></p>
<p>Okay. We don’t get anything back. But what happens is that <code>venv</code> creates a folder where you are in the terminal with packages etc.</p>
<p>Also, we don’t know the version of Python in this environemnt. But in the <a href="https://docs.python.org/3/library/venv.html">Python documentation</a> it says</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>A virtual environment is created on top of an existing Python installation, known as the virtual environment’s “base”</p>
</blockquote>
</blockquote>
<p>In other words: we cannot specify Python version for virtual environments with <code>venv</code>. However, since you can have multiple versions of Python on your computer you can get different answers to these questions depending on where you open a terminal.ß</p>
<p>For example, when I open the temrinal on my Mac I get version Python3 version <code>3.8.13</code>, in the <code>VSCode</code> terminal I get <code>3.7.9</code> and in the RStudio terminal I get <code>3.6.11</code>. Depending on this, I will get different Python versions in the environments that I create with <code>venv</code>. This is not necessarily a bad thing, but it may be confusing for someone who don’t know that much about it.</p>
<p>Anyways, to use the environment we created we need to activate it:</p>
<p><code>{bash eval=FALSE} source mynewenv/bin/activate</code></p>
<p>and then we can then install packages into it:</p>
<p><code>{bash eval=FALSE} pip install pandas numpy</code></p>
<p>And now we can use it:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, np.nan, <span class="dv">6</span>, <span class="dv">8</span>])</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>0    1.0
1    3.0
2    5.0
3    NaN
4    6.0
5    8.0
dtype: float64</code></pre>
</div>
</div>
<p>This works well for interactive usage. But I struggle to get this to work if I want to use the same environment for other projects without having to create a new environment for each project. This is where conda comes in.</p>
</section>
<section id="anaconda-and-conda" class="level2">
<h2 class="anchored" data-anchor-id="anaconda-and-conda">Anaconda and conda</h2>
<p>In the project a colleague of mine had a Jupyter Notebook with some analysis that I wanted to run. Most people I know that uses Jupyter uses it with <a href="https://www.anaconda.com/products/distribution">Anaconda.</a>. You install Anaconda from their <a href="https://www.anaconda.com/products/distribution">website</a>.<br>
<code>Anaconda</code> is not only for Python. On its website it <a href="https://docs.conda.io/projects/conda/en/stable/">says</a>:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>Package, dependency and environment management for any language—Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++, FORTRAN</p>
</blockquote>
</blockquote>
<p>In other words, when you install Anaconda, you install a lot.</p>
<section id="conda" class="level3">
<h3 class="anchored" data-anchor-id="conda">conda</h3>
<p>To use virtual environments in Anaconda you use <code>conda</code> instead of <code>venv</code>. <code>conda</code> also creates the environments in one place so you can use them in multiple projects. You can do this in Anaconda or in the terminal.</p>
<p>The terminal was my approach, since I wanted to use my VSCode instead of Anaconda.</p>
<p>It should be noted that I installed Anaconda and <code>conda</code> a long time ago so I had to update it before getting it to work properly. First run: <code>conda update conda</code>, then <code>conda install anaconda</code>, not sure why and lastly I had to run <code>conda update --all</code> to get it to work the way I wanted. This took a while.</p>
<p>But as soon as it worked I was able to create an environment:</p>
<p><code>{bash eval=FALSE} conda create -n pythonds python=3.8</code></p>
<p>To install packages into the conda environment I ran: <code>conda install -n condaenv numpy=1.19.2 pandas=1.2.3</code></p>
<p>I wanted to use the environment in a Quarto document. To do this I had to register it to <code>ipykernel</code>.</p>
<p><code>{bash eval=FALSE} python -m ipykernel install --user --name=pythonds</code></p>
</section>
</section>
<section id="the-setup-that-now-works-for-me" class="level2">
<h2 class="anchored" data-anchor-id="the-setup-that-now-works-for-me">The setup that now works for me</h2>
<p>At some point we just want things to work. And right now this is what works for me when working with Python.</p>
<ol type="1">
<li>I create virtual environments with conda</li>
<li>When I want to save virtual environments I create a conda.yml file to specify dependencies</li>
<li>Register the environment to the jupyter kernel so I can use them in Quarto and in Jupyter notebooks</li>
</ol>
<p>This setup works for me right now.</p>
</section>
<section id="bonus-tricks" class="level2">
<h2 class="anchored" data-anchor-id="bonus-tricks">Bonus tricks</h2>
<section id="miniconda" class="level3">
<h3 class="anchored" data-anchor-id="miniconda">miniconda</h3>
<p>As I mentioned <code>conda</code> is not restricted to Python. A smaller version of conda, primarily made for Python is <code>miniconda</code>:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>Miniconda is a free minimal installer for conda. It is a small, bootstrap version of Anaconda that includes only conda, Python, the packages they depend on, and a small number of other useful packages, including pip, zlib and a few others. Use the conda install command to install 720+ additional conda packages from the Anaconda repository.”</p>
</blockquote>
</blockquote>
<p>The good thing about Miniconda is that you can use <code>conda</code> in the same way. So to create a virtual environment you do exactly the same: <code>conda create -n minienv python=3.8</code></p>
</section>
<section id="pyenv" class="level3">
<h3 class="anchored" data-anchor-id="pyenv">pyenv</h3>
<p>With conda you can specify Python version, but not with <code>venv</code>. If you want to switch Python versions most people will suggest <code>pyenv</code>. You can use <code>pyenv</code> in a similar fashion.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>